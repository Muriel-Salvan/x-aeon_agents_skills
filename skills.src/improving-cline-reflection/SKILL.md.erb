<%= frontmatter(description: 'Improves Cline reflection from user feedback. What this does is reflect on the user feedback and guidance, then suggests changes in Cline rules and skills. Use this when you are using `agent: attempt_completion` tool for any task that involved user feedback provided at any point during the conversation, or involved multiple non-trivial steps (e.g., multiple file edits, complex logic generation).') %>

# <%= skill_goal 'Improving Cline reflection' %>

Offer opportunities to continuously improve `.clinerules` and skills, based on user interactions and feedback.

<% define_ordered_todo_list do -%>
  ### Offer Reflection
  
  - Always use `agent: ask_followup_question` to ask the user: "Before I complete the task, would you like me to reflect on our interaction and suggest potential improvements to the active `.clinerules` and skills?"
  - Skip all remaining steps of this skill if the user declines or doesn't respond affirmatively.

  ### If User Confirms

  - If the user confirmed, perform the following steps.

  #### 3.1. Review Interaction

  - Synthesize all feedback provided by the user throughout the entire conversation history for the task.
  - Analyze how this feedback relates to the active `.clinerules` and skills, and identify areas where modified instructions could have improved the outcome or better aligned with user preferences.

  #### 3.2. Identify Active Skills and Rules
  
  - List the specific skills and Cline rules that were active during the task.
  - Report this list to the user.

  #### 3.3. Formulate & Propose Improvements
  
  - Generate specific, actionable suggestions for improving the *content* of the relevant active rule files.
  - Prioritize suggestions directly addressing user feedback.
  - Use `replace_in_file` diff blocks when practical, otherwise describe changes clearly.

  #### 3.4. Await User Action on Suggestions
  
  - Always use `agent: ask_followup_question` to ask the user if they agree with the proposed improvements and if they'd like those to be applied *now*.
  - Apply changes if approved.
<% end -%>

## Constraint

Do not offer reflection if:
- No rules or skills were active.
- The task was very simple and involved no feedback.

## When to use it

- Always use it every time the user asks you to improve rules or skills.
- Always use it every time another skill specifically mentions `skill: <%= skill_name %>`.
- Always use it before attempting completion of a task that involved user feedback on active skills and rules.
